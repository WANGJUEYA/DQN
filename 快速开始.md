# DQN模型推理快速开始指南

## 1. 环境准备

### 安装依赖
```bash
# 安装PyTorch (CPU版本)
pip install torch==1.7.1+cpu -f https://download.pytorch.org/whl/torch_stable.html

# 安装其他依赖
pip install gym==0.21.0
pip install numpy
pip install tensorboard
```

### 验证安装
```bash
python -c "import torch; print('PyTorch版本:', torch.__version__)"
python -c "import gym; print('Gym版本:', gym.__version__)"
```

## 2. 训练模型

### CartPole环境
```bash
cd CartPole
python CartPole.py
```

### Maze环境
```bash
cd Maze
python MazeAgent.py
```

训练完成后，模型文件会保存在 `models/` 目录下。

## 3. 模型推理

### 方法1：使用内置推理功能

#### CartPole推理
```bash
cd CartPole
python CartPole.py inference                    # 使用默认模型
python CartPole.py inference cartpole_dqn_final.pth 5  # 指定模型和episode数
```

#### Maze推理
```bash
cd Maze
python MazeAgent.py inference                   # 使用默认模型
python MazeAgent.py inference maze_dqn_final.pth 10   # 指定模型和episode数
```

### 方法2：使用通用推理工具
```bash
# 基本用法
python model_inference.py <模型路径> [环境类型] [episode数量]

# 示例
python model_inference.py models/cartpole_dqn_final.pth cartpole 5
python model_inference.py models/maze_dqn_final.pth maze 10
```

## 4. 自定义推理代码示例

```python
import torch
import numpy as np
import gym
from CartPole.CartPole import DQN

# 创建环境和模型
env = gym.make('CartPole-v0')
env = env.unwrapped
dqn = DQN()

# 加载模型
if dqn.load_model("cartpole_dqn_final.pth"):
    dqn.evaluate_net.eval()  # 设置为推理模式
    
    # 运行推理
    state = env.reset()
    total_reward = 0
    
    for step in range(1000):
        env.render()
        
        # 预测动作（epsilon=0，完全贪婪）
        action = dqn.predict_action(state, epsilon=0.0)
        
        # 执行动作
        next_state, reward, done, _ = env.step(action)
        total_reward += reward
        
        if done:
            print(f"Episode结束，总奖励: {total_reward}")
            break
            
        state = next_state
    
    env.close()
```

## 5. 模型文件结构

训练后的模型文件包含：
- `evaluate_net_state_dict`: 评估网络参数
- `target_net_state_dict`: 目标网络参数  
- `optimizer_state_dict`: 优化器状态
- `hyperparameters`: 超参数配置

## 6. 常见问题

### Q: 模型文件不存在？
A: 请先运行训练脚本生成模型文件

### Q: 导入错误？
A: 确保已安装所有依赖包

### Q: 推理效果不好？
A: 可能需要更多训练轮次，或调整超参数

## 7. 性能优化建议

1. **推理模式**: 使用 `model.eval()` 和 `torch.no_grad()`
2. **设备选择**: 自动检测并使用GPU（如果可用）
3. **批量推理**: 可以修改代码支持批量状态推理
4. **模型压缩**: 可以导出为ONNX格式提高推理速度

## 8. 扩展功能

- 支持更多Gym环境
- 添加模型可视化功能
- 支持模型量化
- 添加性能基准测试

---

**注意**: 首次使用建议先运行训练脚本生成模型文件，再进行推理测试。 